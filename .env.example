# TopDeck Environment Configuration Example
# Copy this file to .env and fill in your values
#
# üìö For detailed setup instructions, see:
#    - LOCAL_TESTING.md - Complete local testing guide
#    - QUICK_START.md - Quick 5-minute setup
#    - README.md - Full documentation

# ============================================
# Quick Start for Local Testing
# ============================================
# 1. Copy this file: cp .env.example .env
# 2. Configure at least one cloud provider below
# 3. Start services: docker compose up -d
# 4. Run TopDeck: make run
#
# See LOCAL_TESTING.md for step-by-step instructions

# ============================================
# Azure Configuration
# ============================================
# To get Azure credentials, create a Service Principal:
# az ad sp create-for-rbac --name "topdeck-local" --role Reader --scopes /subscriptions/YOUR_SUBSCRIPTION_ID
#
# The command above will output:
# - appId ‚Üí AZURE_CLIENT_ID
# - password ‚Üí AZURE_CLIENT_SECRET
# - tenant ‚Üí AZURE_TENANT_ID

AZURE_TENANT_ID=your-tenant-id
AZURE_CLIENT_ID=your-client-id
AZURE_CLIENT_SECRET=your-client-secret
AZURE_SUBSCRIPTION_ID=your-subscription-id

# ============================================
# Azure DevOps Configuration
# ============================================
AZURE_DEVOPS_ORGANIZATION=your-org
AZURE_DEVOPS_PROJECT=your-project  # Optional - leave empty to scan all projects
AZURE_DEVOPS_PAT=your-personal-access-token

# ============================================
# AWS Configuration
# ============================================
# Create IAM user with ReadOnlyAccess policy
# https://console.aws.amazon.com/iam/

AWS_ACCESS_KEY_ID=your-access-key-id
AWS_SECRET_ACCESS_KEY=your-secret-access-key
AWS_REGION=us-east-1  # Change to your preferred region

# ============================================
# GCP Configuration
# ============================================
# Create a service account with Viewer role:
# gcloud iam service-accounts create topdeck-local
# gcloud projects add-iam-policy-binding YOUR_PROJECT --member="serviceAccount:topdeck-local@YOUR_PROJECT.iam.gserviceaccount.com" --role="roles/viewer"
# gcloud iam service-accounts keys create service-account.json --iam-account=topdeck-local@YOUR_PROJECT.iam.gserviceaccount.com

GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json
GCP_PROJECT_ID=your-project-id

# ============================================
# GitHub Configuration
# ============================================
GITHUB_TOKEN=your-github-token
GITHUB_ORGANIZATION=your-org

# ============================================
# Neo4j Configuration (Graph Database)
# ============================================
# Default values work with docker-compose setup for LOCAL DEVELOPMENT ONLY
# Change these if using a custom Neo4j instance
# ‚ö†Ô∏è  WARNING: These are default development passwords from docker-compose.yml
# ‚ö†Ô∏è  NEVER use these passwords in production!

NEO4J_URI=bolt://localhost:7687
# For encrypted connection, use: bolt+s://your-host:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=topdeck123  # ‚ö†Ô∏è  LOCAL DEV ONLY - matches docker-compose.yml
# Set to true to enable TLS encryption (auto-upgrades bolt:// to bolt+s://)
NEO4J_ENCRYPTED=false

# ============================================
# Redis Configuration (Cache)
# ============================================
# Default values work with docker-compose setup for LOCAL DEVELOPMENT ONLY
# Change these if using a custom Redis instance
# ‚ö†Ô∏è  WARNING: These are default development passwords from docker-compose.yml
# ‚ö†Ô∏è  NEVER use these passwords in production!

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=topdeck123  # ‚ö†Ô∏è  LOCAL DEV ONLY - matches docker-compose.yml
REDIS_DB=0
# Enable SSL/TLS encryption for Redis (use port 6380 for SSL)
REDIS_SSL=false
# SSL certificate verification: none, optional, required
REDIS_SSL_CERT_REQS=required

# ============================================
# RabbitMQ Configuration (Message Queue)
# ============================================
# Default values work with docker-compose setup for LOCAL DEVELOPMENT ONLY
# Change these if using a custom RabbitMQ instance
# ‚ö†Ô∏è  WARNING: These are default development passwords from docker-compose.yml
# ‚ö†Ô∏è  NEVER use these passwords in production!

RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
# For SSL, use port 5671
RABBITMQ_USERNAME=topdeck  # ‚ö†Ô∏è  LOCAL DEV ONLY - matches docker-compose.yml
RABBITMQ_PASSWORD=topdeck123  # ‚ö†Ô∏è  LOCAL DEV ONLY - matches docker-compose.yml
# Enable SSL/TLS encryption for RabbitMQ
RABBITMQ_SSL=false

# ============================================
# Application Configuration
# ============================================
APP_ENV=development
APP_PORT=8000
API_KEY=your-api-key
JWT_SECRET=your-jwt-secret

# ============================================
# SSL/TLS Configuration for API Server
# ============================================
# Enable HTTPS for the API server (recommended for production)
SSL_ENABLED=false
# Path to SSL private key file
SSL_KEYFILE=/path/to/private.key
# Path to SSL certificate file
SSL_CERTFILE=/path/to/certificate.crt

# ============================================
# Monitoring & Observability Configuration
# ============================================
# Connect to your existing observability infrastructure
# Prometheus (metrics collection - for performance metrics)
PROMETHEUS_URL=http://localhost:9090

# Tempo (distributed tracing - for trace IDs and spans)
# Point to your existing Tempo instance (e.g., Grafana Cloud or self-hosted)
TEMPO_URL=http://localhost:3200

# Loki (log aggregation - for application logs)
LOKI_URL=http://localhost:3100

# Elasticsearch (log analytics)
# Leave blank if not using Elasticsearch
ELASTICSEARCH_URL=https://elasticsearch.example.com:9200
ELASTICSEARCH_INDEX_PATTERN=logs-*
# Use either API key (recommended) or username/password
ELASTICSEARCH_API_KEY=your-api-key
# ELASTICSEARCH_USERNAME=elastic
# ELASTICSEARCH_PASSWORD=your-password

# Azure Log Analytics (Azure-native logging)
# Leave blank if not using Azure Log Analytics
AZURE_LOG_ANALYTICS_WORKSPACE_ID=your-workspace-id

# Application Insights (Azure monitoring)
APPLICATIONINSIGHTS_CONNECTION_STRING=your-connection-string

# Datadog (optional)
DATADOG_API_KEY=your-datadog-api-key

# ============================================
# Feature Flags
# ============================================
# Enable/disable cloud providers and integrations
# Set to true for providers you want to use

ENABLE_AZURE_DISCOVERY=true
ENABLE_AWS_DISCOVERY=false
ENABLE_GCP_DISCOVERY=false
ENABLE_GITHUB_INTEGRATION=true
ENABLE_AZURE_DEVOPS_INTEGRATION=true
ENABLE_RISK_ANALYSIS=true
ENABLE_MONITORING=true

# ============================================
# Discovery Configuration
# ============================================
# How often TopDeck scans for new/updated resources

DISCOVERY_SCAN_INTERVAL=28800  # 8 hours (in seconds)
# For local testing, you might want more frequent scans:
# DISCOVERY_SCAN_INTERVAL=1800  # 30 minutes

DISCOVERY_PARALLEL_WORKERS=5  # Increase for large infrastructures (500+ resources)
DISCOVERY_TIMEOUT=300  # 5 minutes (increase for large infrastructures)

# ============================================
# Cache Configuration
# ============================================
CACHE_TTL_RESOURCES=300
CACHE_TTL_RISK_SCORES=900
CACHE_TTL_TOPOLOGY=600

# ============================================
# Logging Configuration
# ============================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# ============================================
# Request Configuration
# ============================================
REQUEST_TIMEOUT_SECONDS=30
MAX_REQUEST_SIZE_MB=10

# ============================================
# Rate Limiting Configuration
# ============================================
# Maximum requests per minute per client (token refill rate)
RATE_LIMIT_REQUESTS_PER_MINUTE=60
# Burst size - maximum tokens in bucket (0 = auto: 2x requests per minute)
# Allows handling traffic spikes without immediately hitting rate limits
RATE_LIMIT_BURST_SIZE=120
# Enable rate limiting globally
RATE_LIMIT_ENABLED=true
# Use Redis for distributed rate limiting (recommended for production)
# Falls back to in-memory if Redis is unavailable
RATE_LIMIT_USE_REDIS=true
